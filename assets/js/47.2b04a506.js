(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{367:function(t,e,a){"use strict";a.r(e);var s=a(33),v=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"pcit-ee"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pcit-ee"}},[t._v("#")]),t._v(" PCIT EE")]),t._v(" "),a("h2",{attrs:{id:"运行环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行环境准备"}},[t._v("#")]),t._v(" 运行环境准备")]),t._v(" "),a("p",[t._v("安装好 Docker 并克隆 LNMP 部署环境")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone --depth"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" https://github.com/khs1994-docker/lnmp ~/lnmp\n\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/lnmp\n")])])]),a("h2",{attrs:{id:"准备网站-tls-证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备网站-tls-证书"}},[t._v("#")]),t._v(" 准备网站 TLS 证书")]),t._v(" "),a("p",[t._v("将 "),a("strong",[t._v("公钥")]),t._v(" "),a("strong",[t._v("私钥")]),t._v(" 文件内容合在一起放入 "),a("code",[t._v("~/lnmp/pcit/ssl/ci.crt")]),t._v(" 文件中。")]),t._v(" "),a("h2",{attrs:{id:"配置-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-nginx"}},[t._v("#")]),t._v(" 配置 NGINX")]),t._v(" "),a("p",[t._v("编辑 "),a("code",[t._v("~/lnmp/pcit/conf/pcit.conf")])]),t._v(" "),a("h2",{attrs:{id:"新建-github-app"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新建-github-app"}},[t._v("#")]),t._v(" 新建 GitHub App")]),t._v(" "),a("p",[a("strong",[t._v("在网页创建")])]),t._v(" "),a("p",[t._v("在 GitHub "),a("a",{attrs:{href:"https://github.com/settings/apps/new",target:"_blank",rel:"noopener noreferrer"}},[t._v("Settings > Developer settings > GitHub Apps"),a("OutboundLink")],1),t._v(" 新建 GitHub App")]),t._v(" "),a("p",[t._v("部分重要信息填写如下：")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("Homepage URL")]),t._v(" 网站域名 "),a("code",[t._v("https://ci.example.com:port")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Webhook URL")]),t._v(" Webhooks 接收地址 "),a("code",[t._v("https://ci.example.com:port/webhooks/github")])])])]),t._v(" "),a("p",[t._v("创建完毕之后，生成应用私钥")]),t._v(" "),a("p",[t._v("在 GitHub App 设置("),a("strong",[t._v("General")]),t._v(")-> "),a("code",[t._v("Private keys")]),t._v(" ->右边按钮("),a("strong",[t._v("Generate a private key")]),t._v(")，下载到本地")]),t._v(" "),a("p",[t._v("例如该私钥文件名为 "),a("code",[t._v("pcit.2018-04-28.private-key.pem")])]),t._v(" "),a("p",[t._v("我们需要将其改名为 "),a("code",[t._v("private.key")]),t._v("，之后放入到 "),a("code",[t._v("~/lnmp/pcit/key")]),t._v(" 目录中")]),t._v(" "),a("p",[a("strong",[t._v("使用 PCIT API 创建")])]),t._v(" "),a("p",[t._v("访问 "),a("code",[t._v("https://ci.example.com:port/api/github/app/new?webhook_url=https://smee.io/XXXX")])]),t._v(" "),a("p",[t._v("URL 参数 "),a("strong",[t._v("webhook_url")]),t._v(" 是 webhook 地址，必须公网可以访问，或者使用 smee 代理本地地址。")]),t._v(" "),a("h3",{attrs:{id:"启用-github-app-的-oauth-功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启用-github-app-的-oauth-功能"}},[t._v("#")]),t._v(" 启用 GitHub App 的 OAuth 功能")]),t._v(" "),a("p",[a("strong",[t._v("Identifying and authorizing users")])]),t._v(" "),a("blockquote",[a("p",[t._v("User authorization callback URL")])]),t._v(" "),a("p",[t._v("填入回调地址，例如 "),a("code",[t._v("https://ci.example.com:port/oauth/github")])]),t._v(" "),a("p",[t._v("勾选 "),a("strong",[t._v("Request user authorization (OAuth) during installation")])]),t._v(" "),a("h2",{attrs:{id:"填写关键信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#填写关键信息"}},[t._v("#")]),t._v(" 填写关键信息")]),t._v(" "),a("p",[t._v("编辑 "),a("code",[t._v("~/lnmp/pcit/.env.development")]),t._v(" 文件，设置好相关变量，变量含义请查看 "),a("RouterLink",{attrs:{to:"/install/env.html"}},[t._v("ENV")])],1),t._v(" "),a("h2",{attrs:{id:"启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[t._v("#")]),t._v(" 启动")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ lnmp-docker pcit-up\n")])])]),a("h2",{attrs:{id:"准备项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备项目"}},[t._v("#")]),t._v(" 准备项目")]),t._v(" "),a("p",[t._v("项目根目录包含 "),a("code",[t._v(".pcit.yml")]),t._v("，推送到 GitHub，在 commit 信息处点击小图标查看详情。")])])}),[],!1,null,null,null);e.default=v.exports}}]);